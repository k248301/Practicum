<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crypto Flux - Trending News</title>

    <link rel="stylesheet" href="css/newscss.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <script>
      function formatDate(date) {
        var year = date.getFullYear();
        var month = (date.getMonth() + 1).toString().padStart(2, "0"); // Add leading zero if needed
        var day = date.getDate().toString().padStart(2, "0"); // Add leading zero if needed
        return year + "-" + month + "-" + day;
      }

      function getDates() {
        var today = new Date();
        var twoDaysAgo = new Date(today);
        twoDaysAgo.setDate(today.getDate() - 2);
        return [formatDate(twoDaysAgo), formatDate(today)];
      }

      function fetchNews() {
        displayCards();
        var apiUrl = "https://mouse-funky-tahr.ngrok-free.app/fetch-news";
        fetch(apiUrl, {
          headers: {
            "ngrok-skip-browser-warning": "69420",
          },
        })
          .then((response) => {
            if (!response.ok) {
              alert("Unable to fetch news.");
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            displayNews(data);
          })
          .catch((error) => {
            alert("There was a problem with the News API.");
            console.error(
              "There was a problem with the fetch operation:",
              error
            );
          });
      }

      function displayNews(articles) {
        var newsContainer = document.getElementById("newsContainer");
        newsContainer.innerHTML = "";
        var randomArticles = pickArticles(articles);

        randomArticles.forEach(function (article) {
          var card = document.createElement("div");
          card.classList.add("card");
          card.innerHTML = `
          <img src="${article.urlToImage}" alt="Article Image">
          <div class="card-content">
            <h2>${article.title}</h2>
            <p>${article.description}</p>
            <div class="meta-info">
              <small>Author: ${article.author}</small>
              <br>
              <small>Published: ${article.publishedAt}</small>
            </div>
            <a href="${article.url}" target="_blank">Read More</a>
          </div>
        `;

          // Append card to the container
          newsContainer.appendChild(card);
        });
      }

      function displayCards() {
        var newsContainer = document.getElementById("newsContainer");
        var randomArticles = [1, 2, 3, 4, 5, 6, 7, 8, 9];

        randomArticles.forEach(function (article) {
          var card = document.createElement("div");
          card.classList.add("card");
          card.innerHTML = `
          <div class="card-content">
            <h2></h2>
            <p>Loading...</p>
            <div class="meta-info">
              <small>Author: </small>
              <br>
              <small>Published:</small>
            </div>
            <a href="" target="_blank">Read More</a>
          </div>
        `;
          newsContainer.appendChild(card);
        });
      }

      function pickArticles(array) {
        arrArticles = [];
        for (var i = array.length - 1; i > 0; i--) {
          var idx = Math.floor(Math.random() * (i + 1));
          if (array[idx].urlToImage == "" || array[idx].description == "")
            continue;
          if (arrArticles.length == 9) return arrArticles;
          arrArticles.push(array[idx]);
        }
        return arrArticles;
      }

      document.addEventListener("DOMContentLoaded", function () {
        fetchNews();
      });
    </script>
    <script type="module" src="firebase-script.js"></script>
  </head>

  <body>
    <div class="page-container">
      <nav>
        <div class="logo">
          <img src="media/cryptoflux-logo-white.png" alt="Logo" />
        </div>

        <button class="menu0" aria-label="Toggle navigation">
          <i class="ri-menu-3-line"></i>
        </button>

        <ul class="nav-links">
          <li><a href="home.html">Home</a></li>
          <li><a href="market.html">Market</a></li>
          <li><a href="news.html" class="active">News</a></li>
          <li><a href="trades.html">Trades</a></li>
          <li><button class="btn1" id="logout-button">Logout</button></li>
        </ul>
      </nav>
      <div class="content-wrap">
        <!--<div class="container">
          <div class="container" id="newsContainer">-->
        <!-- News articles will be dynamically added here -->
        <!--</div>
        </div>-->

        <div class="news-section">
          <div class="top-news">
            <div class="main-article" id="mainArticle"></div>
            <div class="side-articles" id="sideArticles"></div>
          </div>

          <div class="slider-container">
            <button class="slider-btn prev" onclick="scrollSlider(-1)">
              ‹
            </button>
            <div class="slider" id="slider"></div>
            <button class="slider-btn next" onclick="scrollSlider(1)">›</button>
          </div>
        </div>
      </div>
      <footer class="footer">
        <div class="footer-container">
          <!-- Left Section -->
          <div class="footer-section footer-left">
            <img
              src="media/cryptoflux-logo-white.png"
              alt="Ease Bot Logo"
              class="footer-logo"
            />
            <p class="footer-company-name">
              &copy; 2025 CryptoFlux. All rights reserved.
            </p>
          </div>
          <!-- Center Section -->
          <div class="footer-section footer-center">
            <div class="footer-item">
              <i class="ri-map-pin-2-line"></i>
              <p>Karachi, Pakistan</p>
            </div>
            <div class="footer-item">
              <i class="ri-phone-line"></i>
              <p>+92 336 386 6753</p>
            </div>
            <div class="footer-item">
              <i class="ri-mail-line"></i>
              <p>
                <a href="mailto:practicum@nu.edu.pk">practicum@nu.edu.pk</a>
              </p>
            </div>
          </div>
          <!-- Right Section -->
          <div class="footer-section footer-right">
            <div class="footer-icons">
              <a href="#"><i class="ri-facebook-circle-fill"></i></a>
              <a href="#"><i class="ri-twitter-x-fill"></i></a>
              <a href="#"><i class="ri-linkedin-box-fill"></i></a>
              <a href="#"><i class="ri-github-fill"></i></a>
            </div>
          </div>
        </div>
      </footer>
    </div>
    <script>
      async function loadNews() {
        // Replace this dummy data with your API later
        const news = [
          {
            cover: "https://source.unsplash.com/800x500/?news",
            headline: "Global Summit Highlights Climate Concerns",
            text: "Leaders from around the world met to discuss urgent actions for climate sustainability.",
          },
          {
            cover: "https://source.unsplash.com/400x300/?sports",
            headline: "Pakistan Clinches Series Victory",
            text: "A thrilling finish led Pakistan to a memorable cricket series win.",
          },
          {
            cover: "https://source.unsplash.com/400x300/?technology",
            headline: "AI Continues to Revolutionize Tech",
            text: "Companies are rapidly adopting AI to automate and enhance efficiency.",
          },
          {
            cover: "https://source.unsplash.com/400x300/?business",
            headline: "Market Sees Unprecedented Growth",
            text: "Investors are optimistic as stock markets hit record highs.",
          },
          {
            cover: "https://source.unsplash.com/400x300/?education",
            headline: "Education Policy Brings Reforms",
            text: "Government introduces new measures to modernize schools nationwide.",
          },
          {
            cover: "https://source.unsplash.com/400x300/?science",
            headline: "Space Mission Achieves New Milestone",
            text: "The spacecraft successfully entered orbit, marking a major achievement.",
          },
          {
            cover: "https://source.unsplash.com/400x300/?finance",
            headline: "Cryptocurrency on the Rise Again",
            text: "Bitcoin surges past key levels as traders anticipate bullish trends.",
          },
          {
            cover: "https://source.unsplash.com/400x300/?culture",
            headline: "Festival Brings Communities Together",
            text: "Colorful performances and traditions mark this year's celebration.",
          },
        ];

        // Display main + side + slider
        displayTopNews(news.slice(0, 4)); // 1 main + 3 side
        displaySlider(news.slice(4)); // remaining for slider
      }

      function displayTopNews(articles) {
        const main = articles[0];
        const sides = articles.slice(1);

        document.getElementById("mainArticle").innerHTML = `
      <img src="${main.cover}" alt="Main Article">
      <div class="overlay">
        <h2>${main.headline}</h2>
        <p>${main.text}</p>
      </div>
    `;

        document.getElementById("sideArticles").innerHTML = sides
          .map(
            (a) => `
      <div class="side-article">
        <img src="${a.cover}" alt="">
        <div class="content">
          <h4>${a.headline}</h4>
          <p>${a.text}</p>
        </div>
      </div>
    `
          )
          .join("");
      }

      function displaySlider(articles) {
        const slider = document.getElementById("slider");
        slider.innerHTML = articles
          .map(
            (a) => `
      <div class="slide">
        <img src="${a.cover}" alt="">
        <div class="slide-content">
          <h5>${a.headline}</h5>
          <p>${a.text}</p>
        </div>
      </div>
    `
          )
          .join("");
      }

      function scrollSlider(direction) {
        const slider = document.getElementById("slider");
        const scrollAmount = 300 * direction;
        slider.scrollBy({ left: scrollAmount, behavior: "smooth" });
      }

      loadNews();
    </script>
  </body>
</html>
